# Cloudflare Pages ä¸Šçš„éƒ¨ç½²æ–‡ä»¶ (SSR ç‹¬ç«‹ç¯å¢ƒé…ç½®)

ç”±äºæ‚¨çš„ Nuxt åº”ç”¨ç›®å‰æ‰“ç®—å‘å¾€ Cloudflare Pages å¹¶ä¸”å¼€å¯ SSRï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© Nuxt åº•éƒ¨çš„ Nitro å¼•æ“æ¥æ— ç¼è¾“å‡º Cloudflare Workers è¾¹ç¼˜æ”¯æŒçš„ Serverã€‚

ä¸‹é¢æ˜¯å¦‚ä½•é…ç½®å’Œéƒ¨ç½²çš„æ–¹æ³•ã€‚

## ä¸€ã€ä¿®æ”¹ Nuxt é…ç½® (nuxt.config.ts)

ä¸ºäº†åœ¨æœ¬åœ°ä¿ç•™åŸæ¥å…³é—­çš„ CSR è¡Œä¸ºè€Œåœ¨ Cloudflare ä¸Šè‡ªåŠ¨åº”ç”¨ SSR ä¸è¾¹ç¼˜è¿è¡Œæ—¶ï¼Œæ‚¨å¯ä»¥ä¸ç”¨ç”Ÿç¡¬åœ°æ”¹æˆ `ssr: true`ï¼Œè€Œæ˜¯åˆ©ç”¨ Nuxt æ”¯æŒçš„ç¯å¢ƒå˜é‡é‡è½½ï¼š

ç¡®ä¿æ‚¨çš„è·¯ç”±é…ç½® **å–æ¶ˆæ³¨é‡Š/è¿˜åŸåˆ°åŸå§‹** (ä¸è¦ä½¿ç”¨ `hashMode: true`):
```ts
// nuxt.config.ts é‡Œé¢ä¸éœ€è¦æ”¹ hash æ¨¡å¼ï¼ŒæŒ‰ä¸‹é¢çš„ç¯å¢ƒå˜é‡å°±å¯ä»¥è®©å…¶åœ¨ CF è‡ªåŠ¨å¼€å¯ SSR 
```

## äºŒã€é…ç½® Cloudflare ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼ˆwrangler.tomlï¼‰

æˆ‘ä»¬å°†åˆ©ç”¨åœ¨é¡¹ç›®æ ¹ç›®å½•é‡Œæ·»åŠ é…ç½®æ–‡ç¨¿ `wrangler.toml` çš„æ–¹å¼ï¼Œæå‰å®šä¹‰å¥½æ„å»ºå‚æ•°ã€‚å®ƒä¼šè®©é¡¹ç›®å€ŸåŠ© Cloudflare å…¨çƒæå…¶è¿…æ·çš„è¾¹ç¼˜ç½‘ç»œè·‘ SSR æœåŠ¡å™¨ï¼Œè€Œéå•çº¯åå‡ºé™æ€æ–‡ä»¶ï¼

æ–°å»ºä¸€ä¸ªæ–‡ä»¶ä¸º `wrangler.toml` å¹¶å­˜å…¥å¦‚ä¸‹é…ç½®ï¼š

```toml
name = "audit-board-cf"
pages_build_output_dir = ".output/public"
compatibility_date = "2024-08-14"

# é…ç½®ç¼–è¯‘æ—¶ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ï¼ˆCF ç»å¸¸éœ€è¦æŒ‡å®šè¿™ä¸ªæ¥ä¸ Nuxt å…¼å®¹ï¼‰
[vars]
NODE_VERSION = "20"
# å› ä¸ºæ‚¨å¸Œæœ›åœ¨ Cloudflare ä¸Šç›´æ¥å¼€å¯ SSRï¼Œæˆ‘ä»¬å¯ä»¥ä¾é  Nuxt è§„åˆ™è¦†ç›–å®ƒ
NUXT_SSR = "true"
# åŒæ—¶å› ä¸ºä½ åœ¨ CF éƒ¨ç½²éœ€è¦å¼€å¯å‡æ•°æ®ï¼Œæ‰€ä»¥æŠŠåŸæœ¬é…ç½®é»˜è®¤å…³é—­çš„ useMock ç¯å¢ƒå˜é‡ä¹Ÿå¼€å¯
NUXT_PUBLIC_USE_MOCK = "true"
```

## ä¸‰ã€éƒ¨ç½²è„šæœ¬ä¸å‘½ä»¤

1. **å®‰è£…ç¯å¢ƒ**ï¼šç¡®ä¿æ‚¨å·²ç»å®‰è£…å¹¶ç™»å½•äº† `wrangler` CLIï¼ˆå¦‚æœæ˜¯åœ¨ä»–ä»¬ç½‘ç«™ä¸Šé…ç½®ï¼Œåˆ™ä¸éœ€è¦ï¼‰ã€‚
   ```bash
   pnpm install -D wrangler
   npx wrangler login
   ```
2. **åœ¨ Cloudflare DashBoard æˆ–æœ¬åœ°ä¿®æ”¹å‘½ä»¤**ï¼š
   æ— è®ºä½¿ç”¨ CLI è¿˜æ˜¯åœ¨äº‘ç«¯è®¾ç½®é¡¹ç›®ï¼Œè¯·ç¡®ä¿ "Build command (æ„å»ºå‘½ä»¤)" å˜æˆï¼š
   ```bash
   pnpm run build
   ```
   > ğŸ”´ é‡ç‚¹ï¼š**è¿™é‡Œæˆ‘ä»¬è¦ç”¨ `pnpm build` æˆ–è€… `NITRO_PRESET=cloudflare-pages pnpm build`**ï¼Œè€Œç»ä¸èƒ½å†ç”¨ä¹‹å‰æ•™ä½ çš„ CSR ç”¨åˆ°çš„ `generate`ï¼å› ä¸º `build` æ‰ä¼šå‘½ä»¤ Nitro ç”Ÿæˆ `_worker.js`ï¼Œè®©è·‘åœ¨äº‘ç«¯è¾¹ç¼˜ç½‘ç»œé‡Œçš„ SSR ç”Ÿæ•ˆã€‚

å¦‚æœä½¿ç”¨ CLI éƒ¨ç½²ï¼Œåªéœ€æ•²å‡»ï¼š
```bash
NITRO_PRESET=cloudflare-pages npx nuxt build
npx wrangler pages deploy .output/public
```

è¿™ä¸¤æ­¥è·‘å®Œï¼Œæ‚¨çš„è®¿é—®é“¾æ¥å°±ä¼šå˜ä¸ºåŸå§‹çš„ `history` è·¯ç”±ï¼Œä¸”é¦–å±æ‰€æœ‰çš„æ•°å­—ä¸ ECharts çš„èƒŒæ™¯ä»£ç ï¼Œç”šè‡³æˆ‘ä»¬åŸå…ˆé…ç½®åœ¨ API æ¥å£å±‚é¢çš„ mock æ•°æ®åˆ¤æ–­ï¼Œéƒ½ä¼šåœ¨æ‚¨èº«è¾¹çš„ Cloudflare è¾¹ç¼˜èŠ‚ç‚¹ä¸Šç«‹åˆ»æ‰§è¡Œå¥½æ‹¼æ¥å®Œå‘ç»™æ‚¨ï¼
